#VRML_SIM R2023b utf8
# license: Copyright Cyberbotics Ltd. Licensed for use only with Webots.
# license: https://cyberbotics.com/webots_assets_license
# A roundabout with multiple exits for driving practice.

PROTO Roundabout [
  field SFVec3f    translation     0 0 0
  field SFRotation rotation        0 0 1 0
  field SFFloat    radius          15
  field SFFloat    roadWidth       6
  field SFInt32    exits           4
  field SFColor    asphalt         0.3 0.3 0.3
  field SFColor    lines           1 1 1
  field SFColor    center          0.2 0.6 0.2
]
{
  Transform {
    translation IS translation
    rotation IS rotation
    children [
      # Main roundabout ring
      DEF ROUNDABOUT_RING Shape {
        appearance PBRAppearance {
          baseColor IS asphalt
          roughness 0.8
          metalness 0.1
        }
        geometry Cylinder {
          height 0.1
          radius IS radius
        }
      }
      # Center island
      DEF CENTER_ISLAND Shape {
        appearance PBRAppearance {
          baseColor IS center
          roughness 0.6
          metalness 0
        }
        geometry Cylinder {
          height 0.15
          radius 9
        }
      }
      # Road markings - outer edge
      DEF OUTER_MARKINGS Transform {
        translation 0 0 0.051
        children [
          Shape {
            appearance PBRAppearance {
              baseColor IS lines
              roughness 0.3
              metalness 0
            }
            geometry IndexedLineSet {
              coord Coordinate {
                point [
                  # Outer circle points (24 points for smooth circle)
                  15 0 0      14.7 3.9 0    13.9 7.7 0    12.7 11.1 0
                  10.6 14.1 0  7.9 16.5 0   4.9 18.2 0    1.6 19.2 0
                  -1.6 19.2 0  -4.9 18.2 0  -7.9 16.5 0   -10.6 14.1 0
                  -12.7 11.1 0 -13.9 7.7 0  -14.7 3.9 0   -15 0 0
                  -14.7 -3.9 0 -13.9 -7.7 0 -12.7 -11.1 0 -10.6 -14.1 0
                  -7.9 -16.5 0 -4.9 -18.2 0 -1.6 -19.2 0  1.6 -19.2 0
                  4.9 -18.2 0  7.9 -16.5 0  10.6 -14.1 0  12.7 -11.1 0
                  13.9 -7.7 0  14.7 -3.9 0
                  
                  # Inner circle points 
                  9 0 0       8.8 2.3 0     8.3 4.6 0     7.6 6.7 0
                  6.4 8.5 0   4.7 9.9 0     2.9 10.9 0    1.0 11.5 0
                  -1.0 11.5 0 -2.9 10.9 0   -4.7 9.9 0    -6.4 8.5 0
                  -7.6 6.7 0  -8.3 4.6 0    -8.8 2.3 0    -9 0 0
                  -8.8 -2.3 0 -8.3 -4.6 0   -7.6 -6.7 0   -6.4 -8.5 0
                  -4.7 -9.9 0 -2.9 -10.9 0  -1.0 -11.5 0  1.0 -11.5 0
                  2.9 -10.9 0 4.7 -9.9 0    6.4 -8.5 0    7.6 -6.7 0
                  8.3 -4.6 0  8.8 -2.3 0
                ]
              }
              coordIndex [
                # Outer circle
                0 1 -1   1 2 -1   2 3 -1   3 4 -1   4 5 -1   5 6 -1
                6 7 -1   7 8 -1   8 9 -1   9 10 -1  10 11 -1 11 12 -1
                12 13 -1 13 14 -1 14 15 -1 15 16 -1 16 17 -1 17 18 -1
                18 19 -1 19 20 -1 20 21 -1 21 22 -1 22 23 -1 23 24 -1
                24 25 -1 25 26 -1 26 27 -1 27 28 -1 28 29 -1 29 0 -1
                
                # Inner circle
                30 31 -1 31 32 -1 32 33 -1 33 34 -1 34 35 -1 35 36 -1
                36 37 -1 37 38 -1 38 39 -1 39 40 -1 40 41 -1 41 42 -1
                42 43 -1 43 44 -1 44 45 -1 45 46 -1 46 47 -1 47 48 -1
                48 49 -1 49 50 -1 50 51 -1 51 52 -1 52 53 -1 53 54 -1
                54 55 -1 55 56 -1 56 57 -1 57 58 -1 58 59 -1 59 30 -1
              ]
            }
          }
        ]
      }
      # North exit road
      DEF NORTH_EXIT Transform {
        translation 0 25 0
        children [
          Shape {
            appearance PBRAppearance {
              baseColor IS asphalt
              roughness 0.8
              metalness 0.1
            }
            geometry Box {
              size 6 20 0.1
            }
          }
        ]
      }
      # South exit road
      DEF SOUTH_EXIT Transform {
        translation 0 -25 0
        children [
          Shape {
            appearance PBRAppearance {
              baseColor IS asphalt
              roughness 0.8
              metalness 0.1
            }
            geometry Box {
              size 6 20 0.1
            }
          }
        ]
      }
      # East exit road
      DEF EAST_EXIT Transform {
        translation 25 0 0
        children [
          Shape {
            appearance PBRAppearance {
              baseColor IS asphalt
              roughness 0.8
              metalness 0.1
            }
            geometry Box {
              size 20 6 0.1
            }
          }
        ]
      }
      # West exit road
      DEF WEST_EXIT Transform {
        translation -25 0 0
        children [
          Shape {
            appearance PBRAppearance {
              baseColor IS asphalt
              roughness 0.8
              metalness 0.1
            }
            geometry Box {
              size 20 6 0.1
            }
          }
        ]
      }
      # Lane divider lines for exits
      DEF EXIT_LINES Transform {
        translation 0 0 0.051
        children [
          Shape {
            appearance PBRAppearance {
              baseColor IS lines
              roughness 0.3
              metalness 0
            }
            geometry IndexedLineSet {
              coord Coordinate {
                point [
                  # North exit center line
                  0 15 0   0 35 0
                  # South exit center line  
                  0 -15 0  0 -35 0
                  # East exit center line
                  15 0 0   35 0 0
                  # West exit center line
                  -15 0 0  -35 0 0
                  
                  # Yield markings at entries
                  -2 13 0  -1 13 0   # North entry left
                  1 13 0   2 13 0    # North entry right
                  -2 -13 0 -1 -13 0  # South entry left
                  1 -13 0  2 -13 0   # South entry right
                  13 -2 0  13 -1 0   # East entry left
                  13 1 0   13 2 0    # East entry right
                  -13 -2 0 -13 -1 0  # West entry left
                  -13 1 0  -13 2 0   # West entry right
                ]
              }
              coordIndex [
                # Center lines
                0 1 -1   2 3 -1   4 5 -1   6 7 -1
                
                # Yield markings
                8 9 -1   10 11 -1  12 13 -1  14 15 -1
                16 17 -1 18 19 -1  20 21 -1  22 23 -1
              ]
            }
          }
        ]
      }
      # Directional arrows
      DEF ARROWS Transform {
        translation 0 0 0.052
        children [
          Shape {
            appearance PBRAppearance {
              baseColor 1 1 1
              roughness 0.3
              metalness 0
            }
            geometry IndexedLineSet {
              coord Coordinate {
                point [
                  # Clockwise arrow on roundabout (right side traffic)
                  6 6 0    8 4 0    # Arrow body
                  8 4 0    9 5 0    # Arrow head right
                  8 4 0    7 3 0    # Arrow head left
                  
                  # Entry arrows
                  0 20 0   0 18 0   # North entry arrow body
                  -1 19 0  0 18 0   # North entry arrow head left
                  1 19 0   0 18 0   # North entry arrow head right
                ]
              }
              coordIndex [
                # Roundabout direction arrow
                0 1 -1   2 3 -1   4 5 -1
                
                # Entry arrow
                6 7 -1   8 9 -1   10 11 -1
              ]
            }
          }
        ]
      }
    ]
  }
}