#VRML_SIM R2023b utf8
PROTO SmartCar [
  field SFVec3f    translation     0 0 0.1
  field SFRotation rotation        0 0 1 0
  field SFColor    color           0.8 0.2 0.2
  field SFString   name            "SmartCar"
  field SFString   controller      "<keyboard>"
  field MFString   controllerArgs  []
  field SFString   customData      ""
  field SFBool     supervisor      FALSE
  field SFBool     synchronization TRUE
]
{
  Robot {
    translation IS translation
    rotation IS rotation
    name IS name
    controller IS controller
    controllerArgs IS controllerArgs
    customData IS customData
    supervisor IS supervisor
    synchronization IS synchronization
    children [
      # Car Body
      DEF BODY Shape {
        appearance PBRAppearance {
          baseColor IS color
          roughness 0.3
          metalness 0.7
        }
        geometry Box {
          size 4.5 2 1.2
        }
      }
      
      # Car Roof
      DEF ROOF Transform {
        translation 0.5 0 0.8
        children [
          Shape {
            appearance PBRAppearance {
              baseColor 0.1 0.1 0.1
              roughness 0.1
              metalness 0.9
            }
            geometry Box {
              size 2.5 1.8 0.8
            }
          }
        ]
      }
      
      # Front Windshield
      DEF WINDSHIELD Transform {
        translation 1.5 0 0.4
        rotation 1 0 0 0.3
        children [
          Shape {
            appearance PBRAppearance {
              baseColor 0.7 0.9 1.0
              transparency 0.3
              roughness 0.0
              metalness 0.0
            }
            geometry Box {
              size 0.1 1.6 0.8
            }
          }
        ]
      }
      
      # Wheels
      DEF FRONT_LEFT_WHEEL HingeJoint {
        jointParameters HingeJointParameters {
          position 0
          axis 0 1 0
          anchor 1.5 1.2 -0.3
        }
        device [
          RotationalMotor {
            name "front_left_wheel"
            controlPID 10 0 0
            maxVelocity 20
          }
          PositionSensor {
            name "front_left_wheel_sensor"
          }
        ]
        endPoint Solid {
          translation 1.5 1.2 -0.3
          rotation 1 0 0 1.5708
          children [
            DEF WHEEL_SHAPE Shape {
              appearance PBRAppearance {
                baseColor 0.1 0.1 0.1
                roughness 1.0
                metalness 0.0
              }
              geometry Cylinder {
                height 0.3
                radius 0.4
              }
            }
          ]
          contactMaterial "wheel"
          boundingObject USE WHEEL_SHAPE
          physics Physics {
            density -1
            mass 10
          }
        }
      }
      
      DEF FRONT_RIGHT_WHEEL HingeJoint {
        jointParameters HingeJointParameters {
          position 0
          axis 0 1 0
          anchor 1.5 -1.2 -0.3
        }
        device [
          RotationalMotor {
            name "front_right_wheel"
            controlPID 10 0 0
            maxVelocity 20
          }
          PositionSensor {
            name "front_right_wheel_sensor"
          }
        ]
        endPoint Solid {
          translation 1.5 -1.2 -0.3
          rotation 1 0 0 1.5708
          children [
            USE WHEEL_SHAPE
          ]
          contactMaterial "wheel"
          boundingObject USE WHEEL_SHAPE
          physics Physics {
            density -1
            mass 10
          }
        }
      }
      
      DEF REAR_LEFT_WHEEL HingeJoint {
        jointParameters HingeJointParameters {
          position 0
          axis 0 1 0
          anchor -1.5 1.2 -0.3
        }
        device [
          RotationalMotor {
            name "rear_left_wheel"
            controlPID 10 0 0
            maxVelocity 20
          }
          PositionSensor {
            name "rear_left_wheel_sensor"
          }
        ]
        endPoint Solid {
          translation -1.5 1.2 -0.3
          rotation 1 0 0 1.5708
          children [
            USE WHEEL_SHAPE
          ]
          contactMaterial "wheel"
          boundingObject USE WHEEL_SHAPE
          physics Physics {
            density -1
            mass 10
          }
        }
      }
      
      DEF REAR_RIGHT_WHEEL HingeJoint {
        jointParameters HingeJointParameters {
          position 0
          axis 0 1 0
          anchor -1.5 -1.2 -0.3
        }
        device [
          RotationalMotor {
            name "rear_right_wheel"
            controlPID 10 0 0
            maxVelocity 20
          }
          PositionSensor {
            name "rear_right_wheel_sensor"
          }
        ]
        endPoint Solid {
          translation -1.5 -1.2 -0.3
          rotation 1 0 0 1.5708
          children [
            USE WHEEL_SHAPE
          ]
          contactMaterial "wheel"
          boundingObject USE WHEEL_SHAPE
          physics Physics {
            density -1
            mass 10
          }
        }
      }
      
      # Camera
      DEF CAMERA Camera {
        translation 2 0 0.8
        rotation 0 1 0 0
        name "camera"
        fieldOfView 1.047
        width 640
        height 480
        near 0.1
        far 100.0
      }
      
      # Distance Sensors for Parking Assistance
      DEF FRONT_DS DistanceSensor {
        translation 2.25 0 0
        rotation 0 1 0 0
        name "front_ds"
        lookupTable [
          0 0 0
          2 2000 0
        ]
        numberOfRays 1
        aperture 0.1
      }
      
      DEF REAR_DS DistanceSensor {
        translation -2.25 0 0
        rotation 0 1 0 3.14159
        name "rear_ds"
        lookupTable [
          0 0 0
          2 2000 0
        ]
        numberOfRays 1
        aperture 0.1
      }
      
      DEF LEFT_DS DistanceSensor {
        translation 0 1.2 0
        rotation 0 1 0 1.5708
        name "left_ds"
        lookupTable [
          0 0 0
          2 2000 0
        ]
        numberOfRays 1
        aperture 0.1
      }
      
      DEF RIGHT_DS DistanceSensor {
        translation 0 -1.2 0
        rotation 0 1 0 -1.5708
        name "right_ds"
        lookupTable [
          0 0 0
          2 2000 0
        ]
        numberOfRays 1
        aperture 0.1
      }
      
      # Front Left Corner Distance Sensor
      DEF FRONT_LEFT_DS DistanceSensor {
        translation 1.8 0.8 0
        rotation 0 1 0 0.785
        name "front_left_ds"
        lookupTable [
          0 0 0
          1.5 1500 0
        ]
        numberOfRays 1
        aperture 0.1
      }
      
      # Front Right Corner Distance Sensor
      DEF FRONT_RIGHT_DS DistanceSensor {
        translation 1.8 -0.8 0
        rotation 0 1 0 -0.785
        name "front_right_ds"
        lookupTable [
          0 0 0
          1.5 1500 0
        ]
        numberOfRays 1
        aperture 0.1
      }
      
      # Rear Left Corner Distance Sensor
      DEF REAR_LEFT_DS DistanceSensor {
        translation -1.8 0.8 0
        rotation 0 1 0 2.356
        name "rear_left_ds"
        lookupTable [
          0 0 0
          1.5 1500 0
        ]
        numberOfRays 1
        aperture 0.1
      }
      
      # Rear Right Corner Distance Sensor
      DEF REAR_RIGHT_DS DistanceSensor {
        translation -1.8 -0.8 0
        rotation 0 1 0 -2.356
        name "rear_right_ds"
        lookupTable [
          0 0 0
          1.5 1500 0
        ]
        numberOfRays 1
        aperture 0.1
      }
      
      # Inertial Unit
      DEF IMU InertialUnit {
        translation 0 0 0
        name "imu"
      }
      
      # GPS
      DEF GPS GPS {
        translation 0 0 1
        name "gps"
      }
      
      # Headlights
      DEF LEFT_HEADLIGHT SpotLight {
        attenuation 0 0 1
        beamWidth 0.8
        cutOffAngle 1.2
        direction 1 0.1 -0.2
        intensity 20
        location 2 0.6 0.3
        on TRUE
        radius 30
      }
      
      DEF RIGHT_HEADLIGHT SpotLight {
        attenuation 0 0 1
        beamWidth 0.8
        cutOffAngle 1.2
        direction 1 -0.1 -0.2
        intensity 20
        location 2 -0.6 0.3
        on TRUE
        radius 30
      }
    ]
    contactMaterial "vehicle"
    boundingObject Group {
      children [
        Transform {
          translation 0 0 0.3
          children [
            Box {
              size 4.5 2 1.2
            }
          ]
        }
      ]
    }
    physics Physics {
      density -1
      mass 1500
      centerOfMass [
        0 0 0
      ]
    }
  }
}