#VRML_SIM R2023b utf8
# license: Copyright Cyberbotics Ltd. Licensed for use only with Webots.
# license: https://cyberbotics.com/webots_assets_license
# documentation url: https://webots.cloud/run?url=https://github.com/cyberbotics/webots/blob/released/projects/vehicles/protos/generic/SmartCar.proto
# keywords: vehicle/car
# A smart car for manual driving with keyboard control and sensor suite.

PROTO SmartCar [
  field SFVec3f    translation     0 0 0.4
  field SFRotation rotation        0 0 1 0
  field SFColor    color           0.43 0.11 0.1
  field SFString   name            "SmartCar"
  field SFString   controller      "<keyboard>"
  field MFString   controllerArgs  []
  field SFString   window          "<generic>"
  field SFBool     supervisor      FALSE
  field SFBool     synchronization TRUE
]
{
  Robot {
    translation IS translation
    rotation IS rotation
    name IS name
    controller IS controller
    controllerArgs IS controllerArgs
    window IS window
    supervisor IS supervisor
    synchronization IS synchronization
    children [
      # Car body
      DEF BODY Shape {
        appearance PBRAppearance {
          baseColor IS color
          metalness 0.6
          roughness 0.4
        }
        geometry Box {
          size 1.8 0.9 0.6
        }
      }
      # Front wheels
      DEF FRONT_RIGHT_WHEEL HingeJoint {
        jointParameters HingeJointParameters {
          position 0
          axis 0 1 0
          anchor 0.6 0.45 -0.05
        }
        device [
          RotationalMotor {
            name "front_right_wheel"
            consumptionFactor 70
            maxVelocity 10
          }
          PositionSensor {
            name "front_right_wheel_sensor"
          }
        ]
        endPoint Solid {
          translation 0.6 0.45 -0.05
          rotation 0 0 1 1.5708
          children [
            DEF WHEEL Shape {
              appearance PBRAppearance {
                baseColor 0.3 0.3 0.3
                roughness 1
                metalness 0
              }
              geometry Cylinder {
                height 0.1
                radius 0.25
              }
            }
          ]
          name "front_right_wheel"
          boundingObject USE WHEEL
          physics Physics {
            density -1
            mass 5
          }
        }
      }
      DEF FRONT_LEFT_WHEEL HingeJoint {
        jointParameters HingeJointParameters {
          position 0
          axis 0 1 0
          anchor 0.6 -0.45 -0.05
        }
        device [
          RotationalMotor {
            name "front_left_wheel"
            consumptionFactor 70
            maxVelocity 10
          }
          PositionSensor {
            name "front_left_wheel_sensor"
          }
        ]
        endPoint Solid {
          translation 0.6 -0.45 -0.05
          rotation 0 0 1 1.5708
          children [
            USE WHEEL
          ]
          name "front_left_wheel"
          boundingObject USE WHEEL
          physics Physics {
            density -1
            mass 5
          }
        }
      }
      # Rear wheels
      DEF REAR_RIGHT_WHEEL HingeJoint {
        jointParameters HingeJointParameters {
          position 0
          axis 0 1 0
          anchor -0.6 0.45 -0.05
        }
        device [
          RotationalMotor {
            name "rear_right_wheel"
            consumptionFactor 70
            maxVelocity 10
          }
          PositionSensor {
            name "rear_right_wheel_sensor"
          }
        ]
        endPoint Solid {
          translation -0.6 0.45 -0.05
          rotation 0 0 1 1.5708
          children [
            USE WHEEL
          ]
          name "rear_right_wheel"
          boundingObject USE WHEEL
          physics Physics {
            density -1
            mass 5
          }
        }
      }
      DEF REAR_LEFT_WHEEL HingeJoint {
        jointParameters HingeJointParameters {
          position 0
          axis 0 1 0
          anchor -0.6 -0.45 -0.05
        }
        device [
          RotationalMotor {
            name "rear_left_wheel"
            consumptionFactor 70
            maxVelocity 10
          }
          PositionSensor {
            name "rear_left_wheel_sensor"
          }
        ]
        endPoint Solid {
          translation -0.6 -0.45 -0.05
          rotation 0 0 1 1.5708
          children [
            USE WHEEL
          ]
          name "rear_left_wheel"
          boundingObject USE WHEEL
          physics Physics {
            density -1
            mass 5
          }
        }
      }
      # Camera for vision
      DEF CAMERA Camera {
        translation 0.8 0 0.4
        rotation 0 0 1 0
        name "camera"
        fieldOfView 1.047
        width 640
        height 480
        near 0.1
        far 1000
      }
      # Distance sensors for parking assistance
      DEF FRONT_SENSOR DistanceSensor {
        translation 0.9 0 0
        rotation 0 0 1 0
        name "front_sensor"
        lookupTable [
          0 0 0
          5 5000 0
        ]
        type "sonar"
      }
      DEF REAR_SENSOR DistanceSensor {
        translation -0.9 0 0
        rotation 0 0 1 3.14159
        name "rear_sensor"
        lookupTable [
          0 0 0
          5 5000 0
        ]
        type "sonar"
      }
      DEF LEFT_SENSOR DistanceSensor {
        translation 0 -0.45 0
        rotation 0 0 1 -1.5708
        name "left_sensor"
        lookupTable [
          0 0 0
          3 3000 0
        ]
        type "sonar"
      }
      DEF RIGHT_SENSOR DistanceSensor {
        translation 0 0.45 0
        rotation 0 0 1 1.5708
        name "right_sensor"
        lookupTable [
          0 0 0
          3 3000 0
        ]
        type "sonar"
      }
      # Inertial unit for orientation
      DEF IMU InertialUnit {
        translation 0 0 0
        name "imu"
      }
      # GPS for position tracking
      DEF GPS GPS {
        translation 0 0 0.1
        name "gps"
      }
    ]
    name IS name
    model "SmartCar"
    boundingObject USE BODY
    physics Physics {
      density -1
      mass 1000
      centerOfMass [ 0 0 0 ]
      inertiaMatrix [
        166.667 0 0
        0 416.667 0
        0 0 416.667
      ]
    }
  }
}