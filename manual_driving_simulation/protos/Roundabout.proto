#VRML_SIM R2023b utf8
PROTO Roundabout [
  field SFVec3f    translation  0 0 0
  field SFRotation rotation     0 0 1 0
  field SFString   name         "Roundabout"
  field SFFloat    radius       8
  field SFFloat    roadWidth    6
]
{
  Group {
    children [
      # Central Island
      DEF CENTRAL_ISLAND Transform {
        translation IS translation
        rotation IS rotation
        children [
          Shape {
            appearance PBRAppearance {
              baseColor 0.2 0.6 0.2
              roughness 0.8
              metalness 0.0
            }
            geometry Cylinder {
              height 0.1
              radius 6
            }
          }
        ]
      }
      
      # Central Island Decoration - Fountain Base
      DEF FOUNTAIN_BASE Transform {
        translation IS translation
        rotation IS rotation
        children [
          Transform {
            translation 0 0 0.1
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 0.8 0.8 0.9
                  roughness 0.3
                  metalness 0.1
                }
                geometry Cylinder {
                  height 0.3
                  radius 2
                }
              }
            ]
          }
        ]
      }
      
      # Central Fountain
      DEF FOUNTAIN Transform {
        translation IS translation
        rotation IS rotation
        children [
          Transform {
            translation 0 0 0.25
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 0.6 0.8 1.0
                  transparency 0.3
                  roughness 0.0
                  metalness 0.0
                }
                geometry Cylinder {
                  height 1.5
                  radius 0.5
                }
              }
            ]
          }
        ]
      }
      
      # Roundabout Road Surface - Outer Ring
      DEF ROAD_SURFACE Transform {
        translation IS translation
        rotation IS rotation
        children [
          Shape {
            appearance PBRAppearance {
              baseColor 0.3 0.3 0.3
              roughness 0.8
              metalness 0.0
            }
            geometry Box {
              size 28 28 0.1
            }
          }
        ]
      }
      
      # Inner Circle Line (separating road from island)
      DEF INNER_CIRCLE Transform {
        translation IS translation
        rotation IS rotation
        children [
          Shape {
            appearance PBRAppearance {
              baseColor 1 1 1
              emissiveColor 0.2 0.2 0.2
            }
            geometry IndexedLineSet {
              coord Coordinate {
                point [
                  # Inner circle - 32 points for smooth circle
                  6.5 0 0.02
                  6.36 1.24 0.02
                  5.95 2.43 0.02
                  5.30 3.53 0.02
                  4.43 4.49 0.02
                  3.37 5.30 0.02
                  2.16 5.95 0.02
                  0.87 6.36 0.02
                  -0.43 6.50 0.02
                  -1.74 6.36 0.02
                  -2.96 5.95 0.02
                  -4.06 5.30 0.02
                  -5.00 4.43 0.02
                  -5.77 3.37 0.02
                  -6.32 2.16 0.02
                  -6.65 0.87 0.02
                  -6.75 -0.43 0.02
                  -6.61 -1.74 0.02
                  -6.24 -2.96 0.02
                  -5.65 -4.06 0.02
                  -4.85 -5.00 0.02
                  -3.88 -5.77 0.02
                  -2.78 -6.32 0.02
                  -1.59 -6.65 0.02
                  -0.35 -6.75 0.02
                  0.89 -6.61 0.02
                  2.10 -6.24 0.02
                  3.24 -5.65 0.02
                  4.27 -4.85 0.02
                  5.16 -3.88 0.02
                  5.89 -2.78 0.02
                  6.42 -1.59 0.02
                ]
              }
              coordIndex [
                0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 0, -1
              ]
            }
          }
        ]
      }
      
      # Outer Circle Line (road boundary)
      DEF OUTER_CIRCLE Transform {
        translation IS translation
        rotation IS rotation
        children [
          Shape {
            appearance PBRAppearance {
              baseColor 1 1 1
              emissiveColor 0.2 0.2 0.2
            }
            geometry IndexedLineSet {
              coord Coordinate {
                point [
                  # Outer circle - 32 points for smooth circle
                  12.5 0 0.02
                  12.24 2.39 0.02
                  11.46 4.68 0.02
                  10.19 6.80 0.02
                  8.50 8.66 0.02
                  6.46 10.19 0.02
                  4.15 11.33 0.02
                  1.67 12.04 0.02
                  -0.83 12.50 0.02
                  -3.34 12.24 0.02
                  -5.69 11.46 0.02
                  -7.81 10.19 0.02
                  -9.62 8.50 0.02
                  -11.08 6.46 0.02
                  -12.15 4.15 0.02
                  -12.78 1.67 0.02
                  -12.97 -0.83 0.02
                  -12.71 -3.34 0.02
                  -12.00 -5.69 0.02
                  -10.87 -7.81 0.02
                  -9.34 -9.62 0.02
                  -7.46 -11.08 0.02
                  -5.34 -12.15 0.02
                  -3.05 -12.78 0.02
                  -0.67 -12.97 0.02
                  1.71 -12.71 0.02
                  4.04 -12.00 0.02
                  6.23 -10.87 0.02
                  8.21 -9.34 0.02
                  9.92 -7.46 0.02
                  11.32 -5.34 0.02
                  12.35 -3.05 0.02
                ]
              }
              coordIndex [
                0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 0, -1
              ]
            }
          }
        ]
      }
      
      # Lane Divider Lines (dashed lines in the middle of the road)
      DEF LANE_DIVIDERS Transform {
        translation IS translation
        rotation IS rotation
        children [
          Shape {
            appearance PBRAppearance {
              baseColor 1 1 0.8
              emissiveColor 0.1 0.1 0.08
            }
            geometry IndexedLineSet {
              coord Coordinate {
                point [
                  # Middle lane divider - dashed circle
                  9.5 0 0.02
                  9.3 1.82 0.02
                  8.7 3.56 0.02
                  7.74 5.16 0.02
                  6.46 6.58 0.02
                  4.91 7.74 0.02
                  3.15 8.62 0.02
                  1.27 9.17 0.02
                  -0.63 9.50 0.02
                  -2.54 9.30 0.02
                  -4.32 8.70 0.02
                  -5.93 7.74 0.02
                  -7.31 6.46 0.02
                  -8.41 4.91 0.02
                  -9.21 3.15 0.02
                  -9.68 1.27 0.02
                  -9.82 -0.63 0.02
                  -9.64 -2.54 0.02
                  -9.14 -4.32 0.02
                  -8.25 -5.93 0.02
                  -7.09 -7.31 0.02
                  -5.66 -8.41 0.02
                  -4.05 -9.21 0.02
                  -2.31 -9.68 0.02
                  -0.51 -9.82 0.02
                  1.30 -9.64 0.02
                  3.07 -9.14 0.02
                  4.72 -8.25 0.02
                  6.23 -7.09 0.02
                  7.53 -5.66 0.02
                  8.59 -4.05 0.02
                  9.37 -2.31 0.02
                ]
              }
              coordIndex [
                # Dashed line segments
                0, 1, -1,
                2, 3, -1,
                4, 5, -1,
                6, 7, -1,
                8, 9, -1,
                10, 11, -1,
                12, 13, -1,
                14, 15, -1,
                16, 17, -1,
                18, 19, -1,
                20, 21, -1,
                22, 23, -1,
                24, 25, -1,
                26, 27, -1,
                28, 29, -1,
                30, 31, -1
              ]
            }
          }
        ]
      }
      
      # Yield Signs at Entrances
      DEF YIELD_SIGN_NORTH Transform {
        translation IS translation
        rotation IS rotation
        children [
          Transform {
            translation 0 14 1
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 1 1 1
                  roughness 0.2
                  metalness 0.0
                }
                geometry Box {
                  size 1.5 0.1 2
                }
              }
            ]
          }
          Transform {
            translation 0 14 1
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 1 0 0
                  emissiveColor 0.3 0 0
                }
                geometry Text {
                  string ["YIELD"]
                  fontName "SERIF"
                  size 0.8
                  justification ["MIDDLE"]
                }
              }
            ]
          }
        ]
      }
      
      DEF YIELD_SIGN_EAST Transform {
        translation IS translation
        rotation IS rotation
        children [
          Transform {
            translation 14 0 1
            rotation 0 0 1 -1.5708
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 1 1 1
                  roughness 0.2
                  metalness 0.0
                }
                geometry Box {
                  size 1.5 0.1 2
                }
              }
            ]
          }
          Transform {
            translation 14 0 1
            rotation 0 0 1 -1.5708
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 1 0 0
                  emissiveColor 0.3 0 0
                }
                geometry Text {
                  string ["YIELD"]
                  fontName "SERIF"
                  size 0.8
                  justification ["MIDDLE"]
                }
              }
            ]
          }
        ]
      }
      
      DEF YIELD_SIGN_SOUTH Transform {
        translation IS translation
        rotation IS rotation
        children [
          Transform {
            translation 0 -14 1
            rotation 0 0 1 3.14159
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 1 1 1
                  roughness 0.2
                  metalness 0.0
                }
                geometry Box {
                  size 1.5 0.1 2
                }
              }
            ]
          }
          Transform {
            translation 0 -14 1
            rotation 0 0 1 3.14159
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 1 0 0
                  emissiveColor 0.3 0 0
                }
                geometry Text {
                  string ["YIELD"]
                  fontName "SERIF"
                  size 0.8
                  justification ["MIDDLE"]
                }
              }
            ]
          }
        ]
      }
      
      DEF YIELD_SIGN_WEST Transform {
        translation IS translation
        rotation IS rotation
        children [
          Transform {
            translation -14 0 1
            rotation 0 0 1 1.5708
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 1 1 1
                  roughness 0.2
                  metalness 0.0
                }
                geometry Box {
                  size 1.5 0.1 2
                }
              }
            ]
          }
          Transform {
            translation -14 0 1
            rotation 0 0 1 1.5708
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 1 0 0
                  emissiveColor 0.3 0 0
                }
                geometry Text {
                  string ["YIELD"]
                  fontName "SERIF"
                  size 0.8
                  justification ["MIDDLE"]
                }
              }
            ]
          }
        ]
      }
    ]
  }
}